<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hotel Room PMS</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.dashboard{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.card{background:#fff;padding:12px;border-radius:8px;min-width:140px;text-align:center;box-shadow:0 0 5px rgba(0,0,0,.1)}
.top-actions{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
button{padding:6px 10px;border:0;border-radius:5px;cursor:pointer}
.btn-export{background:#3498db;color:#fff}
.btn-daily{background:#27ae60;color:#fff}
.btn-reset{background:#e74c3c;color:#fff}
.btn-audit{background:#8e44ad;color:#fff}

.room-grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
gap:12px
}

.room-box{
height:135px;
border-radius:10px;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
color:#fff;
font-size:13px;
cursor:pointer;
text-align:center;
padding:4px;
}

.room-vacant{background:#2ecc71}
.room-occupied{background:#e74c3c}
.room-blocked{background:#7f8c8d}
.room-no{font-weight:bold;font-size:15px}
.small{font-size:11px}
</style>
</head>
<body>

<h2>Hotel Room PMS</h2>

<div class="top-actions">
<button class="btn-export" onclick="exportCurrent()">Export Current Status</button>
<button class="btn-daily" onclick="exportDaily()">Export Daily Report</button>

<button onclick="setFilter('all')">All</button>
<button onclick="setFilter('Occupied')">Occupied</button>
<button onclick="setFilter('Vacant')">Vacant</button>
<button onclick="setFilter('Blocked')">Maintenance</button>

<button class="btn-audit" onclick="nightAudit()">Night Audit</button>
<button class="btn-reset" onclick="resetAll()">Reset</button>
</div>

<div class="dashboard">
<div class="card">Business Date<br><b id="bizDate"></b></div>
<div class="card">Total<br><b id="tTotal"></b></div>
<div class="card">Occupied<br><b id="tOcc"></b></div>
<div class="card">Vacant<br><b id="tVac"></b></div>
<div class="card">Maintenance<br><b id="tBlk"></b></div>
<div class="card">Checkout Today<br><b id="tCo"></b></div>
</div>

<div id="roomGrid" class="room-grid"></div>

<script>

const roomNumbers=["001","002","101","102","103","104","105","106","201","202","203","204","205","206","301","302","303","304"];

let rooms=[],logs=[],todayCheckouts=0,filter="all",bookingSources=[],businessDate="";

const KEY="ROHIT_PMS_V6";
const API_URL="https://script.google.com/macros/s/AKfycbzXNd7NPsdZnQhQYd95sUIHUYzWDtLv4_XPsCGZGnfhnmhiErR8qVc1UuUGGUehb1EA/exec";

function todayISO(){return new Date().toISOString().slice(0,10);}
function now(){return new Date().toISOString();}
function nextDate(d){let x=new Date(d);x.setDate(x.getDate()+1);return x.toISOString().slice(0,10);}

/* ---------- init ---------- */

function init(){
businessDate=todayISO();
rooms=[];
roomNumbers.forEach(n=>{
rooms.push({
roomNo:n,status:"Vacant",guest:"",rate:"",plan:"",source:"",folio:0,
lastGuest:"",lastRate:"",lastPlan:"",lastSource:"",
checkInAt:"",checkOutAt:""
});
});
bookingSources=["Walk-in","MakeMyTrip","Goibibo","Booking.com","Agoda"];
logs=[];
todayCheckouts=0;
save();
}

/* ---------- storage ---------- */

function save(){
fetch(API_URL,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({key:KEY,data:{rooms,logs,todayCheckouts,bookingSources,businessDate}})
});
}

async function load(){
try{
let res=await fetch(API_URL+"?key="+KEY);
let d=await res.json();

if(!d || !d.rooms){
init();
return;
}

rooms=d.rooms||[];
logs=d.logs||[];
bookingSources=d.bookingSources||["Walk-in"];
businessDate=d.businessDate||todayISO();
todayCheckouts=d.todayCheckouts||0;

}catch(e){
alert("DB load failed");
console.log(e);
}
}

/* --------- rest of your code unchanged --------- */
/* (roomAction, render, export, night audit etc) */

/* ---------- reset ---------- */

function resetAll(){
if(!confirm("Reset all PMS data?")) return;
init();
render();
}

/* ---------- start ---------- */

load().then(render);

</script>
</body>
</html>
